(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-69339180"],{"15f6":function(e,t,s){"use strict";s.r(t);s("14d9");var i=s("b76a"),a=s.n(i),l={name:"SiteSelector",components:{HsDrawer:s("1feb").a,Draggable:a.a},props:{currentColumn:{type:Object,default:()=>{}}},data:()=>({searchText:"",searchType:"siteName",selectSites:[],selectSiteIndex:[],sites:[],preSelectSiteIndex:[]}),computed:{displaySites(){return"tag"===this.searchType?this.searchText?this.sites.filter(e=>{if(e.expand&&"{}"!==e.expand)try{return JSON.parse(e.expand).tag.some(t=>{if(t.toUpperCase().includes(this.searchText.toUpperCase()))return e.targetTagName=t,!0})}catch{console.log("标签筛选异常")}}):this.sites:this.sites.filter(e=>e.name.toUpperCase().includes(this.searchText.toUpperCase()))},searchPlaceholderText(){return"请输入"+("tag"===this.searchType?"标签":"网站")+"名称"},showTag(){return this.searchText&&"tag"===this.searchType}},watch:{selectSiteIndex(){this.handleSelectSite()},sites(){this.handleSelectSite()},currentColumn:{handler(e,t){try{this.selectSiteIndex=Array.isArray(JSON.parse(e.siteStore))?[...JSON.parse(e.siteStore)]:[],this.preSelectSiteIndex=[...this.selectSiteIndex]}catch(e){this.selectSiteIndex=[]}},deep:!0,immediate:!0}},mounted(){this.querySite()},methods:{querySite(){this.API.findSiteByList({},{notify:!1}).then(e=>{this.sites=e.data})},handleSelectSite(){let e=[];this.selectSiteIndex.forEach(t=>{this.sites.some(s=>{if(s._id===t)return e.push(s),!0})}),this.selectSites=e},getSelectStatus(e){return this.selectSiteIndex.includes(e._id)},imgUrl:e=>e.icon?e.icon:s("4101"),selectSite(e){let{_id:t}=e,s=this.selectSiteIndex.indexOf(t);-1===s?this.selectSiteIndex.push(t):this.selectSiteIndex.splice(s,1)},async save(){let e=[],t=[];t=this.preSelectSiteIndex.filter(e=>-1===this.selectSiteIndex.indexOf(e)),e=this.selectSiteIndex.filter(e=>-1===this.preSelectSiteIndex.indexOf(e));let s=this.selectSites.map(e=>e._id);await this.API.updateColumn({_id:this.currentColumn._id,siteStore:JSON.stringify(s)}),e.length&&await this.API.bindColumnToSite({columnId:this.currentColumn._id,sites:e}),t.length&&await this.API.unbindColumnToSite({columnId:this.currentColumn._id,sites:t}),this.$emit("save")},cancel(){this.$emit("cancel"),this.$emit("update:visible",!1)},remove(e,t){let s=this.selectSiteIndex.indexOf(e._id);-1!==s&&this.selectSiteIndex.splice(s,1)}}},c=(s("5610"),s("2877")),n=Object(c.a)(l,(function(){var e=this,t=e._self._c;return t("HsDrawer",e._g(e._b({},"HsDrawer",e.$attrs,!1),e.$listeners),[t("div",{staticClass:"site-selector"},[t("div",{staticClass:"site-selector-main"},[t("div",{staticClass:"selected"},[t("div",{staticClass:"header"},[t("div",{staticClass:"title"},[e._v("已选择")])]),t("ul",{staticClass:"site-list"},[t("Draggable",{attrs:{filter:".no-drap",animation:"400"},model:{value:e.selectSites,callback:function(t){e.selectSites=t},expression:"selectSites"}},[t("transition-group",e._l(e.selectSites,(function(s,i){return t("li",{key:s._id,staticClass:"site-item drag-item"},[t("i",{staticClass:"el-icon-rank pointer"}),t("div",{staticClass:"name text no-drap"},[e._v(e._s(e._f("emptyTip")(s.name)))]),t("div",{staticClass:"description text no-drap"},[e._v(e._s(e._f("emptyTip")(s.description)))]),t("i",{staticClass:"el-icon-delete pointer remove no-drap",on:{click:function(t){return e.remove(s,i)}}})])})),0)],1)],1)]),t("div",{staticClass:"selecting"},[t("div",{staticClass:"header"},[t("div",{staticClass:"title"},[e._v("待选择")]),t("div",{staticClass:"search"},[t("el-select",{model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},[t("el-option",{attrs:{label:"标签名",value:"tag"}}),t("el-option",{attrs:{label:"网站名",value:"siteName"}})],1),t("el-input",{attrs:{placeholder:e.searchPlaceholderText,"suffix-icon":"el-icon-search"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1)]),t("ul",{staticClass:"site-group"},e._l(e.displaySites,(function(s){return t("li",{key:s._id,staticClass:"site",class:{active:e.getSelectStatus(s)},on:{click:function(t){return e.selectSite(s)}}},[t("div",{staticClass:"icon-group"},[t("img",{directives:[{name:"lazy",rawName:"v-lazy"}],attrs:{src:e.imgUrl(s)}})]),t("div",{staticClass:"text-group"},[t("div",{staticClass:"name text",attrs:{title:s.name}},[e._v(e._s(e._f("emptyTip")(s.name)))]),t("div",{staticClass:"description text",attrs:{title:s.description}},[e._v(e._s(e._f("emptyTip")(e.showTag?s.targetTagName:s.description)))])])])})),0)])]),t("div",{staticClass:"site-selector-footer"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.save}},[e._v("确定配置")]),t("el-button",{attrs:{type:"warning",plain:""},on:{click:e.cancel}},[e._v("取消修改")])],1)])])}),[],!1,null,"a76d5570",null);t.default=n.exports},"428e":function(e,t,s){},5610:function(e,t,s){"use strict";s("428e")}}]);