(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-04cbda18"],{"0d7c":function(e,t,l){},"278d":function(e,t,l){"use strict";l.r(t);l("14d9");var a=l("45a3"),r=l("dc92"),i={name:"Setting",props:{},components:{VueJsonEditor:a.a},computed:{setting:{get(){let{site:e,theme:t,mail:l,article:a}=this;return{site:e,theme:t,mail:l,article:a}},set(e){}}},data:()=>({loaded:!1,activeNames:["1","2","3","4"],site:{brandName:"花森",brandUrl:"",redirectUrl:"http://huasenjio.top/",guidePageName:"花森小窝",guidePageUrl:"http://huasenjio.top/",footerHtml:"",openLabelClassification:!1,jwt:"",jwtLiveTime:604800,serviceQRCodeUrl:""},siteRule:{redirectUrl:[{validator:Object(r.b)(["isUrl::链接格式不正确"]),trigger:"change"}],guidePageUrl:[{validator:Object(r.b)(["isUrl::链接格式不正确"]),trigger:"change"}],brandUrl:[{validator:Object(r.b)(["isImgUrl::链接格式不正确"]),trigger:"change"}],serviceQRCodeUrl:[{validator:Object(r.b)(["isImgUrl::链接格式不正确"]),trigger:"change"}],jwt:[{validator:Object(r.b)(["minLength:32::请输入32个字符","maxLength:32::请输入32个字符","isEnglish::请输入数字/字母"]),trigger:"change"}]},mail:{host:"smtp.qq.com",port:465,user:"932397243@qq.com",mtp:""},article:{changelog:"",about:"",help:"",notice:""},theme:{pure:[{color:"#FFFFFF",background:"#000000"},{color:"#000000",background:"#FFFFFF"}],wallpaper:[{headerFontColor:"#FFFFFF",background:"https://s2.loli.net/2023/03/31/oSz3nJB84dC5ueh.jpg"},{headerFontColor:"#000000",background:"https://s2.loli.net/2023/03/31/W9n7RoFvhtlpg6U.jpg"}],default:{bg:"",color:""}},themeRule:{"default.bg":[{validator:Object(r.b)(["isBg::内容不正确"]),trigger:"change"}],"default.color":[{validator:Object(r.b)(["isColorCode::内容不正确"]),trigger:"change"}]},articleOptions:[],currentUploading:{form:null,key:""},originPure:[],originWallpaper:[]}),created(){this.queryConfig(),this.queryArticle()},watch:{settingJSON:{handler(e){this.setting=e},immediate:!0}},methods:{reset(){this.$refs.siteForm.resetFields(),this.$refs.mailForm.resetFields(),this.$refs.themeForm.resetFields(),this.$refs.articleForm.resetFields(),this.theme.pure=this.LODASH.cloneDeep(this.originPure),this.theme.wallpaper=this.LODASH.cloneDeep(this.originWallpaper),this.$tips("success","重置配置表单成功",null,2e3)},queryConfig(){this.API.findAppConfig({},{notify:!1}).then(e=>{this.loaded=!1;const{site:t,mail:l,theme:a,article:r}=e.data;this.TOOL.mergeByOwnKey(this.site,t),this.TOOL.mergeByOwnKey(this.mail,l),this.TOOL.mergeByOwnKey(this.article,r),this.LODASH.get(a,"pure")&&(this.theme.pure=this.LODASH.get(a,"pure")),this.LODASH.get(a,"wallpaper")&&(this.theme.wallpaper=this.LODASH.get(a,"wallpaper")),this.TOOL.mergeByOwnKey(this.theme.default,this.LODASH.get(a,"default")),this.originPure=this.LODASH.cloneDeep(this.theme.pure),this.originWallpaper=this.LODASH.cloneDeep(this.theme.wallpaper),this.loaded=!0})},saveConfig(){let e=[];e.push(this.checkForm("siteForm"),this.checkForm("mailForm"),this.checkForm("themeForm"),this.checkForm("articleForm")),Promise.all(e).then(()=>{this.API.saveAppConfig({systemConfig:JSON.stringify(this.setting,null,2)},{secret:!0}).then(e=>{this.loaded=!1,this.originPure=this.LODASH.cloneDeep(this.theme.pure),this.originWallpaper=this.LODASH.cloneDeep(this.theme.wallpaper),this.$nextTick(()=>{this.loaded=!0})})}).catch(()=>{this.$tips("error","校验失败，请检查配置输入项！",null,2e3)})},checkForm(e){return new Promise((t,l)=>{this.$refs[e].validate(e=>{e?t():l()})})},queryArticle(){this.API.findArticleByList({},{notify:!1}).then(e=>{this.articleOptions=e.data.map(e=>({label:e.title,value:e._id}))})},checkImgUrl:e=>Object(r.a)([{value:e,rules:[{strategy:"isNoEmpty",errMsg:"必填项"},{strategy:"isImgUrl",errMsg:"内容格式不正确"}]}]),checkColorCode:e=>Object(r.a)([{value:e,rules:[{strategy:"isNoEmpty",errMsg:"必填项"},{strategy:"isColorCode",errMsg:"内容格式不正确"}]}]),addTheme(e){let t;switch(e){case"pure":t={color:"#ffffff",background:"#000000"};break;case"wallpaper":t={headerFontColor:"#FFFFFF",background:""}}t&&this.theme[e].push(t)},handleUpload(e,t){this.currentUploading.form=e,this.currentUploading.key=t;let l=document.getElementById("js-img-picker");l&&l.click()},upload(e){const t=e.target.files[0];let l=new FormData;l.append("file",t),this.API.uploadFile(l,{url:"/manage/upload?type=img"}).then(t=>{this.currentUploading.form[this.currentUploading.key]=this.LODASH.get(t.data,"0.path"),e.target.value=null})},removeTheme(e,t,l){this.theme[e].splice(l,1)},setDefaultTheme(e,t,l){this.theme.default.bg=t.background,this.theme.default.color="pure"===e?t.color:t.headerFontColor}}},s=(l("43a4"),l("2bd8"),l("2877")),o=Object(s.a)(i,(function(){var e=this,t=e._self._c;return e.loaded?t("div",{staticClass:"setting"},[t("el-collapse",{staticClass:"setting-collapse",model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[t("el-collapse-item",{attrs:{name:"1"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-monitor mr-px-4"}),e._v(" 站点配置")]),t("el-form",{ref:"siteForm",staticClass:"site-form",attrs:{model:e.site,rules:e.siteRule}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"brandName"}},[t("el-input",{attrs:{placeholder:"请输入品牌名"},model:{value:e.site.brandName,callback:function(t){e.$set(e.site,"brandName",t)},expression:"site.brandName"}},[t("template",{slot:"prepend"},[e._v("品牌名称")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"brandUrl"}},[t("el-input",{attrs:{placeholder:"请输入链接"},model:{value:e.site.brandUrl,callback:function(t){e.$set(e.site,"brandUrl",t)},expression:"site.brandUrl"}},[t("template",{slot:"prepend"},[e._v("品牌图片")]),t("el-button",{attrs:{slot:"append",icon:"el-icon-picture"},on:{click:function(t){return e.handleUpload(e.site,"brandUrl")}},slot:"append"})],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"redirectUrl"}},[t("el-input",{attrs:{placeholder:"请输入重定向地址"},model:{value:e.site.redirectUrl,callback:function(t){e.$set(e.site,"redirectUrl",t)},expression:"site.redirectUrl"}},[t("template",{slot:"prepend"},[e._v("重定向地址")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"serviceQRCodeUrl"}},[t("el-input",{attrs:{placeholder:"请输入二维码地址"},model:{value:e.site.serviceQRCodeUrl,callback:function(t){e.$set(e.site,"serviceQRCodeUrl",t)},expression:"site.serviceQRCodeUrl"}},[t("template",{slot:"prepend"},[e._v("客服二维码")]),t("el-button",{attrs:{slot:"append",icon:"el-icon-picture"},on:{click:function(t){return e.handleUpload(e.site,"serviceQRCodeUrl")}},slot:"append"})],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"guidePageName"}},[t("el-input",{attrs:{placeholder:"请输入引导页名称"},model:{value:e.site.guidePageName,callback:function(t){e.$set(e.site,"guidePageName",t)},expression:"site.guidePageName"}},[t("template",{slot:"prepend"},[e._v("引导页名称")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"guidePageUrl"}},[t("el-input",{attrs:{placeholder:"请输入引导页地址"},model:{value:e.site.guidePageUrl,callback:function(t){e.$set(e.site,"guidePageUrl",t)},expression:"site.guidePageUrl"}},[t("template",{slot:"prepend"},[e._v("引导页地址")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"footerHtml"}},[t("el-input",{attrs:{placeholder:"请输入页脚代码"},model:{value:e.site.footerHtml,callback:function(t){e.$set(e.site,"footerHtml",t)},expression:"site.footerHtml"}},[t("template",{slot:"prepend"},[e._v("页脚代码")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"jwt"}},[t("el-input",{attrs:{placeholder:"请输入令牌密钥"},model:{value:e.site.jwt,callback:function(t){e.$set(e.site,"jwt",t)},expression:"site.jwt"}},[t("template",{slot:"prepend"},[e._v("令牌密钥")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"jwtLiveTime"}},[t("el-input",{attrs:{placeholder:"1000 = 1秒"},on:{input:t=>e.site.jwtLiveTime=Number(t.replace(/[^0-9.]/g,""))||604800},model:{value:e.site.jwtLiveTime,callback:function(t){e.$set(e.site,"jwtLiveTime",t)},expression:"site.jwtLiveTime"}},[t("template",{slot:"prepend"},[e._v("令牌存活时间")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"openLabelClassification"}},[t("el-switch",{attrs:{"active-text":"开启标签分类","inactive-text":"关闭标签分类"},model:{value:e.site.openLabelClassification,callback:function(t){e.$set(e.site,"openLabelClassification",t)},expression:"site.openLabelClassification"}})],1)],1)],1)],1)],2),t("el-collapse-item",{attrs:{name:"2"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-magic-stick mr-px-4"}),e._v("主题配置")]),t("el-form",{ref:"themeForm",staticClass:"theme-form",attrs:{model:e.theme,rules:e.themeRule}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"default.bg"}},[t("el-input",{attrs:{placeholder:"< 图片链接 | 颜色代码 >"},model:{value:e.theme.default.bg,callback:function(t){e.$set(e.theme.default,"bg",t)},expression:"theme.default.bg"}},[t("template",{slot:"prepend"},[e._v("默认背景")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"default.color"}},[t("el-input",{attrs:{placeholder:"< 颜色代码 >"},model:{value:e.theme.default.color,callback:function(t){e.$set(e.theme.default,"color",t)},expression:"theme.default.color"}},[t("template",{slot:"prepend"},[e._v("背景字体颜色")])],2)],1)],1)],1),t("div",{staticClass:"pure"},[t("div",{staticClass:"px-px-2 text-bold"},[e._v(" 纯色背景列表 "),t("i",{staticClass:"el-icon-circle-plus text-green-500 pointer",on:{click:function(t){return e.addTheme("pure")}}})]),t("ul",{staticClass:"flex overflow-x-auto px-px-2 py-px-6"},e._l(e.theme.pure,(function(l,a){return t("li",{key:a,staticClass:"flex-shrink-0 w-px-184 relative ml-px-15 first:ml-px-0 shadow p-px-8 rounded"},[t("i",{staticClass:"el-icon-top absolute -top-px-6 right-px-12 z-10 text-blue-500 pointer",attrs:{title:"设为默认"},on:{click:function(t){return e.setDefaultTheme("pure",l,a)}}}),t("i",{staticClass:"el-icon-remove absolute -top-px-6 -right-px-4 z-10 text-red-500 pointer",attrs:{title:"移除色块"},on:{click:function(t){return e.removeTheme("pure",l,a)}}}),t("el-tooltip",{staticClass:"item",attrs:{disabled:!e.checkColorCode(l.background),effect:"light",content:"内容格式非法",placement:"right"}},[t("el-input",{class:{"error-tip":!!e.checkColorCode(l.background)},attrs:{placeholder:"背景颜色"},model:{value:l.background,callback:function(t){e.$set(l,"background",t)},expression:"item.background"}},[t("el-color-picker",{staticClass:"relative top-px-5 left-px-0",attrs:{slot:"prefix","popper-class":"setting-color-picker-popper",size:"mini"},slot:"prefix",model:{value:l.background,callback:function(t){e.$set(l,"background",t)},expression:"item.background"}})],1)],1),t("el-tooltip",{staticClass:"item",attrs:{disabled:!e.checkColorCode(l.color),effect:"light",content:"内容格式非法",placement:"right"}},[t("el-input",{staticClass:"mt-px-4",class:{"error-tip":!!e.checkColorCode(l.color)},attrs:{placeholder:"字体颜色"},model:{value:l.color,callback:function(t){e.$set(l,"color",t)},expression:"item.color"}},[t("el-color-picker",{staticClass:"relative top-px-5 left-px-0",attrs:{slot:"prefix","popper-class":"setting-color-picker-popper",size:"mini"},slot:"prefix",model:{value:l.color,callback:function(t){e.$set(l,"color",t)},expression:"item.color"}})],1)],1)],1)})),0)]),t("div",{staticClass:"wallpaper"},[t("div",{staticClass:"px-px-2 text-bold"},[e._v(" 壁纸背景列表 "),t("i",{staticClass:"el-icon-circle-plus text-green-500 pointer",on:{click:function(t){return e.addTheme("wallpaper")}}})]),t("ul",{staticClass:"flex overflow-x-auto px-px-2 py-px-6"},e._l(e.theme.wallpaper,(function(a,r){return t("li",{key:r,staticClass:"flex-shrink-0 w-px-184 relative ml-px-15 first:ml-px-0 shadow p-px-8 rounded"},[t("i",{staticClass:"el-icon-top absolute -top-px-6 right-px-12 z-10 text-blue-500 pointer",attrs:{title:"设为默认"},on:{click:function(t){return e.setDefaultTheme("wallpaper",a,r)}}}),t("i",{staticClass:"el-icon-remove absolute -top-px-6 -right-px-4 z-10 text-red-500 pointer",attrs:{title:"移除壁纸"},on:{click:function(t){return e.removeTheme("wallpaper",a,r)}}}),t("div",{staticClass:"w-full h-px-80 mb-px-4 text-center p-px-4 bg-gray-100 border border-dashed border-gray-400 rounded"},[t("img",{directives:[{name:"lazy",rawName:"v-lazy",value:{unload:l("4101")},expression:"{ unload: require('@/assets/img/error/image-error.png') }"}],staticClass:"max-w-full max-h-full rounded",attrs:{src:a.background}})]),t("el-tooltip",{staticClass:"item",attrs:{disabled:!e.checkImgUrl(a.background),effect:"light",content:"内容格式非法",placement:"right"}},[t("el-input",{class:{"error-tip":!!e.checkImgUrl(a.background)},attrs:{placeholder:"图片链接"},model:{value:a.background,callback:function(t){e.$set(a,"background",t)},expression:"item.background"}},[t("div",{staticClass:"w-px-28 h-px-28 p-px-4 relative top-px-5 left-px-0 border border-solid border-gray-300 rounded flex justify-center items-center pointer",attrs:{slot:"prefix"},slot:"prefix"},[t("i",{staticClass:"el-icon-picture text-lg text-gray-600",on:{click:function(t){return e.handleUpload(a,"background")}}})])])],1),t("el-tooltip",{staticClass:"item",attrs:{disabled:!e.checkColorCode(a.headerFontColor),effect:"light",content:"内容格式非法",placement:"right"}},[t("el-input",{staticClass:"mt-px-4",class:{"error-tip":!!e.checkColorCode(a.headerFontColor)},attrs:{placeholder:"字体颜色"},model:{value:a.headerFontColor,callback:function(t){e.$set(a,"headerFontColor",t)},expression:"item.headerFontColor"}},[t("el-color-picker",{staticClass:"relative top-px-5 left-px-0",attrs:{slot:"prefix","popper-class":"setting-color-picker-popper",size:"mini"},slot:"prefix",model:{value:a.headerFontColor,callback:function(t){e.$set(a,"headerFontColor",t)},expression:"item.headerFontColor"}})],1)],1)],1)})),0)])],1)],2),t("el-collapse-item",{attrs:{name:"3"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-document mr-px-4"}),e._v("文章配置")]),t("el-form",{ref:"articleForm",staticClass:"article-form",attrs:{model:e.article,"label-position":"top"}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"changelog",label:"更新日志"}},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择更新日志"},model:{value:e.article.changelog,callback:function(t){e.$set(e.article,"changelog",t)},expression:"article.changelog"}},e._l(e.articleOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"about",label:"关于我们"}},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择关于我们"},model:{value:e.article.about,callback:function(t){e.$set(e.article,"about",t)},expression:"article.about"}},e._l(e.articleOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"help",label:"帮助文档"}},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择帮助文档"},model:{value:e.article.help,callback:function(t){e.$set(e.article,"help",t)},expression:"article.help"}},e._l(e.articleOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"notice",label:"网站公告"}},[t("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择网站公告"},model:{value:e.article.notice,callback:function(t){e.$set(e.article,"notice",t)},expression:"article.notice"}},e._l(e.articleOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1)],1)],2),t("el-collapse-item",{attrs:{name:"4"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-message mr-px-4"}),e._v("邮箱配置")]),t("el-form",{ref:"mailForm",staticClass:"mail-form",attrs:{model:e.mail}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"host"}},[t("el-input",{attrs:{placeholder:"< 主机 >"},model:{value:e.mail.host,callback:function(t){e.$set(e.mail,"host",t)},expression:"mail.host"}},[t("template",{slot:"prepend"},[e._v("host")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"port"}},[t("el-input",{attrs:{placeholder:"< 端口 >"},on:{input:t=>e.mail.port=Number(t.replace(/[^0-9.]/g,""))||465},model:{value:e.mail.port,callback:function(t){e.$set(e.mail,"port",t)},expression:"mail.port"}},[t("template",{slot:"prepend"},[e._v("port")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"user"}},[t("el-input",{attrs:{placeholder:"< 用户 >"},model:{value:e.mail.user,callback:function(t){e.$set(e.mail,"user",t)},expression:"mail.user"}},[t("template",{slot:"prepend"},[e._v("user")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{prop:"mtp"}},[t("el-input",{attrs:{placeholder:"< 通行码 >"},model:{value:e.mail.mtp,callback:function(t){e.$set(e.mail,"mtp",t)},expression:"mail.mtp"}},[t("template",{slot:"prepend"},[e._v("mtp")])],2)],1)],1)],1)],1)],2),t("el-collapse-item",{attrs:{name:"5"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-table-lamp mr-px-4"}),e._v("配置总览")]),t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:24}},[t("div",{staticClass:"result"},[t("VueJsonEditor",{staticClass:"json-edit",attrs:{"show-btns":!1,expandedOnStart:!0,mode:"form"},model:{value:e.setting,callback:function(t){e.setting=t},expression:"setting"}})],1)])],1)],2)],1),t("div",{staticClass:"operation mt-px-10 flex justify-end"},[t("el-button",{attrs:{type:"primary"},on:{click:e.saveConfig}},[e._v("保存配置")]),t("el-button",{attrs:{type:"danger"},on:{click:e.reset}},[e._v("重置配置")])],1),t("input",{staticStyle:{display:"none"},attrs:{id:"js-img-picker",accept:"image/gif,image/jpeg,image/jpg,image/png",type:"file"},on:{change:function(t){return e.upload(t)}}})],1):e._e()}),[],!1,null,"329e3f91",null);t.default=o.exports},"2bd8":function(e,t,l){"use strict";l("0d7c")},"43a4":function(e,t,l){"use strict";l("e6f6")},e6f6:function(e,t,l){}}]);